# Журнал изменений

## 1.0.11 — 27.02.2026

### Реестры / UI
- Боковое меню: «Контроли» переименованы в «Реестры» и перемещены между «Инциденты» и «Отчеты».
- UI «Реестры» (страница `/registry`): добавлены вкладки навигации к реестрам «Активы», «ПО», «Замечания» (с учётом `menu_permissions`).
- UI «Реестры»: маршруты вкладок переведены на path-формат `/registry/<tab>` (например, `/registry/frameworks` вместо query-параметра `?tab=frameworks`).
- UI «Реестры»: добавлено логирование посещения вкладок через `/api/app/view` (для отладки).
- UI «Реестры»: устранена вспышка индикатора загрузки при первом открытии вкладок «Активы/ПО/Замечания».
- Реестры: удалены кнопки «Обновить» и «Экспорт CSV» (экспорт доступен только через модуль отчётов).
- Реестры: добавлена кнопка «Создать отчет» в «Активы», «ПО», «Замечания» — формирует отчёт (markdown) из текущей выборки/фильтров и открывает его в модуле «Отчеты».
- Реестры: теги приведены к единому UI-контролу (multiselect как в Документах) для «Активы», «ПО», «Замечания» и корректно отображаются в таблицах по label (а не по raw-коду).
- Модальные окна: добавлена универсальная обработка кнопок закрытия (`data-close`) для стабильной работы «Отмена» и крестика во всех вкладках.
- UI: поправлены отступы кнопок «Применить» (Активы) и «Добавить версию» (модалка продукта ПО).

### Мониторинг
- Добавлено состояние «DNS» (оранжевое): при ошибках резолва/host-not-found монитор не шлёт уведомления и не генерирует «UP» после восстановления резолва.
- Добавлен фильтр по типу «DNS» в центре событий и настройка «Логировать DNS-проблемы как события» (по умолчанию включена).

### Замечания (Findings)
- Postgres runtime: исправлена автогенерация `findings.id` (устранён `500` при создании записи).
- UI: выбор тегов в модалке приведён к multiselect-паттерну документов (селектор + подсказка выбранных тегов).
- UI: после создания замечания модальное окно закрывается, без автопереоткрытия в режиме редактирования.

### Активы
- Старт работ над модулем «Активы»: согласована MVP-модель данных, права доступа (RBAC) и принципы интеграции (дизайн-спека в документации).
- Добавлены миграции БД для таблицы `assets` (PostgreSQL + sqlite test runtime).
- Добавлен базовый CRUD API `/api/assets` с zero-trust (RBAC + `menu_permissions`) и аудитом действий `assets.create/update/archive/restore`.
- Добавлена UI-вкладка «Активы» (страница `/assets` + формы создания/редактирования/архивирования/восстановления) с полной RU/EN локализацией.
- Инциденты: добавлен тип связи `asset` и быстрый переход к активу из карточки инцидента.
- Контроли: добавлен тип связи `asset` (с проверкой `assets.view` + `menu_permissions`) и быстрый переход к активу из карточки контроля.
- Задачи: добавлен тип связи `asset` (с проверкой `assets.view` + `menu_permissions`) и подбор активов через поиск в модальном окне задачи.
- Мониторинг: добавлена привязка активов к монитору (список + управление) с проверками `assets.view` + `menu_permissions` и аудитом.
- Документы: добавлен тип связи `asset` (селектор активов, переходы) и серверная фильтрация связей по `assets.view` + `menu_permissions`.
- Инциденты: связанные активы дополнительно отображаются в паспорте инцидента (рядом с полем meta.assets) и скрываются без `assets.view` + `menu_permissions`.

### Находки
- Реализован модуль «Находки»: миграции БД, store-слой и CRUD API `/api/findings` (list/search/get/create/update/archive/restore) с RBAC + `menu_permissions` и аудитом `finding.*`.
- Добавлены связи «Находка ↔ сущности» через `entity_links` и UI-управление связями (asset/control/incident/task/doc), при этом для `asset`/`control` выполняется серверная проверка прав и доступности вкладок.
- Добавлена UI-вкладка «Находки» (страница `/findings`: фильтры, таблица, карточка, архив/восстановление, теги, связи) с полной RU/EN локализацией.
- Добавлен CSV экспорт для «Активов» и «Находок»: API `/api/assets/export.csv` и `/api/findings/export.csv` + кнопка «Экспорт CSV» в UI, события аудита `assets.export.csv` и `finding.export.csv`.
- Добавлены endpoints автодополнения: `/api/assets/autocomplete` (owners/administrators/tags) и `/api/findings/autocomplete` (titles/owners/tags).
- Усилены валидаторы для «Находок» (status/severity/type) и добавлены тесты zero-trust/RBAC для stage 4.

### ПО
- Реализован модуль «ПО»: миграции БД и CRUD API `/api/software` (list/search/get/create/update/archive/restore) с RBAC + `menu_permissions` и аудитом `software.*`.
- Добавлен реестр версий ПО: endpoints `/api/software/{id}/versions` (create/update/archive/restore) с аудитом `software.version.*`.
- Добавлена UI-вкладка «ПО» (страница `/software`: таблица, карточка продукта, управление версиями, архив/восстановление) с полной RU/EN локализацией.
- Активы ↔ ПО: добавлены установки ПО на активе (список + создание/редактирование/архив/восстановление) с серверными проверками прав по обоим доменам (`assets.*` и `software.*`) и аудитом `assets.software.*`.
- Добавлен CSV экспорт и автодополнение для реестра ПО: `/api/software/export.csv`, `/api/software/autocomplete` + событие аудита `software.export.csv`.
- Интеграции связей: добавлен тип `software` в селекторы связей (Findings/Controls/Incidents/Tasks/Docs) и серверная валидация ссылок с проверкой `software.view` + `menu_permissions`.

### Безопасность
- Zero-trust по вкладкам: `menu_permissions` теперь покрывает вкладку `findings` (и `/api/findings`).
- Добавлены тесты, гарантирующие `403` при запрете вкладки даже при наличии прав у роли.

### Обновления
- В настройках блок «Доступно обновление» стал заметнее и содержит ссылку на релиз.
- В боковом меню под строкой версии появляется мини-кнопка «Доступно обновление» со ссылкой на latest release (только если включен чекбокс «Проверять обновления»).

### UI/UX
- Мониторинг: в карточке выбранного монитора ссылка-цель отображается как гиперссылка (только в detail, не в списке).
- Заголовок вкладки браузера изменён на `Security Control Center`.
