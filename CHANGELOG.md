# Журнал изменений

## 1.0.3 — 13.02.2026

### Архитектура и платформа
- Сформирован полноценный модуль бэкапов `.bscc` с разделением слоёв: `router -> handler -> service -> store`.
- Добавлены и применяются миграции PostgreSQL для бэкапов, restore-run, планов и scheduler-полей.
- Приложение переведено на единый источник версии: `core/appmeta.AppVersion = "1.0.3"` с поддержкой переопределения через `-ldflags`.

### Бэкапы (.bscc)
- Полный цикл `.bscc`: create/import/download/delete.
- Restore engine: dry-run и реальное восстановление с пошаговым прогрессом.
- Backup plan + scheduler + retention policy, включая пресеты расписаний и выборочный ручной запуск (`label/scope/include_files`).
- Проверка совместимости manifest и пост-проверка схемы после restore.

### Безопасность
- Zero-trust проверки прав сохранены на всех endpoint; права backup-модуля нормализованы.
- Усилен hardening upload/download/delete (лимиты, path validation, защита от traversal).
- Добавлены конкурентные блокировки create/import/restore/delete и корректные `409`.
- Maintenance mode строго активируется на время restore; ошибки API приведены к безопасному формату.

### Визуал и UX
- Добавлен раздел «Бэкапы» в меню с вкладками: `Обзор`, `История`, `Восстановление`, `Расписание`.
- Вкладки бэкапов подключены как отдельные маршруты (`/backups/*`) с поддержкой прямых ссылок.
- Восстановление и история получили рабочие действия и прогресс в UI.

### Мониторинг SLA
- В «Мониторинг» добавлена вкладка `SLA` с карточками по мониторам, статусами `24h/7d/30d` и настройками политики инцидентов.
- Добавлена история закрытых периодов (`day/week/month`) и coverage-aware модель (`ok/violated/unknown`).
- Запущен background SLA evaluator (закрытие периодов, идемпотентные результаты, без дублей).
- SLA-инциденты создаются только на закрытии выбранного периода и только при включенной policy.
- Добавлены endpoint’ы:
  - `GET /api/monitoring/sla/overview`
  - `GET /api/monitoring/sla/history`
  - `PUT /api/monitoring/monitors/{id}/sla-policy`

### Локализация (RU/EN)
- Обновлены и нормализованы i18n-ключи для backups/monitoring/SLA.
- Синхронизированы подписи действий в журнале аудита.

### Надёжность и исправления
- Исправлены ключевые сценарии restore: зависшие run-state, стабильность polling/status, cleanup fail-сценариев, корректное завершение maintenance mode.
- `pg_restore` переведён в строгий режим (`--clean --if-exists --exit-on-error`).
- Для мониторинга доработаны стабильность статусов/уведомлений и визуал графиков (time-axis, tooltip, down-zones, агрегация длинных диапазонов).
- Центр событий вынесен в отдельную вкладку `/monitoring/events`.
- Разрешение приватных сетей в мониторинге включено по умолчанию.

### Тесты и качество
- Добавлены unit/интеграционные проверки для backup-модуля, прав доступа и конкурентных сценариев.
- Критические сценарии 1.0.3 покрыты `make ci`.

### Документация
- Обновлены `README` и RU/EN docs под 1.0.3.
- Синхронизированы API/wiki: новые вкладки мониторинга, SLA-endpoint’ы, behavior закрытых периодов.

### Техобслуживание (мониторинг)
- Добавлена отдельная вкладка `/monitoring/maintenance` рядом с SLA.
- Реализованы стратегии окон обслуживания: `single`, `cron`, `interval`, `weekday`, `monthday`.
- Добавлены операции полного цикла: создание, редактирование, остановка, возобновление и удаление окон.
- Окна техобслуживания учитываются как accepted risk и исключаются из SLA-штрафов.
- UI окна техобслуживания обновлен: улучшена сетка модального окна, унифицированы чекбоксы, поля даты/времени и селекты.
